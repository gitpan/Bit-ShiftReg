# INSTRUCTIONS FOR BUILDING THE Bit::ShiftReg PPC SHARED LIBRARY
	


# (1) Copy the Bit-ShiftReg-2.0 folder from the expanded Bit-ShiftReg-2.0.tar.gz archive into the 
#     :MacPerl_Src:perl:ext folder of the MacPerl source distribution.
#  
#     and then
#
#     Set the current directory to the Bit-ShiftReg-2.0 folder (via Directory menu).




# (2) Set the MPW variable 'MPSrc' to the path to your MacPerl_Src folder, for example     

Set MPSrc "MacintoshHD:MacPerl_Src"     # (change the path accordingly)




# (3) Run the XSUBpp compiler for ShiftReg.xs

perl :::lib:ExtUtils:xsubpp -typemap :::lib:ExtUtils:typemap -typemap :typemap  ShiftReg.xs >ShiftReg.tc && Rename -y ShiftReg.tc ShiftReg.c





# (4) If you like, take a look at the resulting C source file ShiftReg.c

open ShiftReg.c



# (5) Compile ShiftReg.c (with symbol export for shared lib):

MrC -inclpath ignoresys -sym off -d __STD_C -d MULTIPLICITY  -w off -opt size -t -fatext ¶
	-d MPW_HAS_BOOL ¶
	-i {MPSrc}: ¶
	-i {MPSrc}:sfio:include: ¶
	-i {MPSrc}:GUSI:include: ¶
	-i {MPSrc}:perl: ¶
	-i : ¶
	-shared_lib_export on ¶
	-export_list ShiftReg.exp "ShiftReg".c





# (6) Open the file which contains a list of the shared library's exported entry points (symbols).
#     Delete every line except the last, which is:
#      
#	  boot_Bit__ShiftReg
#
#     Be sure to save your changes.

open ShiftReg.exp




# (7) Link ShiftReg.c.ppc.o as shared lib. 


PPCLink -w -xm sharedlibrary -sym on -@export ShiftReg.exp ¶
	:ShiftReg.c.ppc.o ¶
	{MPSrc}:perl:PerlStub ¶
	{SharedLibraries}InterfaceLib ¶
	{SharedLibraries}StdCLib ¶
	{SharedLibraries}MathLib ¶
	-c 'cfmg' -t 'shlb' -fragname "ShiftReg" -o ShiftReg.shlb.PPC


	

# (8) Rename the shared library 'ShiftReg.shlb.PPC' to 'ShiftReg'

Rename -y ShiftReg.shlb.PPC ShiftReg




#  Done. The shared library 'ShiftReg' must be installed in the ':site_perl:MacPPC:auto:Bit:ShiftReg' folder.


